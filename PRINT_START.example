[gcode_macro PRINT_START]
gcode:
    ###################################################################
    # PRINT_START (Generic + Adaptive Flow Zero-Config)
    ###################################################################

    # 1. Get Params (MATERIAL no longer needed - auto-detected from temp)
    {% set target_bed      = params.BED|default(60)|int %}
    {% set target_extruder = params.EXTRUDER|default(200)|int %}
    
    # 2. Standard Start Routine
    M117 Homing...
    G28
    G90

    M117 Heating Bed...
    M140 S{target_bed}
    TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={target_bed}

    # Optional: Insert Mesh Logic Here
    # BED_MESH_CALIBRATE ADAPTIVE=1

    M117 Heating Nozzle...
    M109 S{target_extruder}

    # 3. Prime Line (optional - insert your preferred purge here)
    # G1 X10 Y10 Z0.3 F3000
    # G1 X100 E10 F1500
    # G92 E0

    # 4. ENABLE ADAPTIVE FLOW (Zero-Config)
    # AT_START automatically:
    #   - Detects material from extruder target temperature
    #   - Applies appropriate K-values and PA
    #   - Auto-calibrates baseline on first print (if needed)
    #   - Self-learns optimal settings over time
    AT_START

    M117 Printing...


[gcode_macro PRINT_END]
gcode:
    # 1. Disable Adaptive Flow (reports learned data)
    AT_END
    
    # 2. Standard End Routine
    TURN_OFF_HEATERS
    M107                         ; Fan off
    
    # 3. Safe Z Raise
    G91
    G1 E-2 F2700                 ; Retract
    G1 Z10 F3000                 ; Raise Z
    G90
    
    # 4. Present Print
    G1 X10 Y200 F6000            ; Move to front
    
    # 5. Motors Off
    M84
    M117 Print Complete.
